"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.patchTransformer = void 0;

var _utils = require("../../utils");

const resolveTsCompilerOptions = () => {
  const tsCompilerOptions = (0, _utils.readCompilerOptions)() || {};
  const {
    jsx
  } = tsCompilerOptions;

  if (!jsx) {
    return null;
  }

  tsCompilerOptions.jsx = 'react-jsx';
  return tsCompilerOptions;
};
/**
 * Map `TestConfig.transformer` to jest config
 */


const patchTransformer = testOperator => {
  const {
    transformer
  } = testOperator.testConfig;

  if (transformer === 'babel-jest') {
    testOperator.mergeJestConfig({
      transform: {
        '\\.[jt]sx?$': require.resolve("../transformer/babelTransformer")
      }
    });
  }

  if (transformer === 'ts-jest') {
    testOperator.mergeJestConfig({
      transform: {
        '\\.[jt]sx?$': require.resolve('ts-jest')
      }
    });
    const compilerOptions = resolveTsCompilerOptions();
    compilerOptions && testOperator.mergeJestConfig({
      globals: {
        'ts-jest': {
          tsconfig: compilerOptions
        }
      }
    });
  }
};

exports.patchTransformer = patchTransformer;