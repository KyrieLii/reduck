"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.bump = bump;

var _utils = require("../utils");

async function bump(options) {
  const {
    snapshot,
    canary,
    preid,
    ignore
  } = options;
  const params = [_utils.CHANGESET_PATH, 'version'];

  if (snapshot) {
    params.push('--snapshot');

    if (typeof snapshot === 'string') {
      params.push(snapshot);
    }
  }

  if (ignore) {
    ignore.forEach(pkg => {
      params.push('--ignore');
      params.push(pkg);
    });
  }

  if (canary) {
    await (0, _utils.execaWithStreamLog)(process.execPath, [_utils.CHANGESET_PATH, 'pre', 'enter', preid || 'next']);

    try {
      await (0, _utils.execaWithStreamLog)(process.execPath, params);
      await (0, _utils.execaWithStreamLog)(process.execPath, [_utils.CHANGESET_PATH, 'pre', 'exit']);
    } catch (e) {
      await (0, _utils.execaWithStreamLog)(process.execPath, [_utils.CHANGESET_PATH, 'pre', 'exit']);
    }
  } else {
    await (0, _utils.execaWithStreamLog)(process.execPath, params);
  }
}